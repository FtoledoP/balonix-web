<div class="team-register-container">
  <h2>{{ getStepTitle() }}</h2>
  <form (ngSubmit)="registerTeam()">
    <div [ngSwitch]="currentStep">
      <!-- Step 1: Team Info -->
      <div *ngSwitchCase="1">
        <div class="form-group">
          <label for="teamName">Nombre del Equipo</label>
          <div class="input-with-icon">
            <i class="fas fa-users"></i>
            <input type="text" id="teamName" name="teamName" [(ngModel)]="teamName" required>
          </div>
        </div>
        <div class="form-group">
          <label for="region">Región</label>
          <div class="input-with-icon">
            <i class="fas fa-map-marker-alt"></i>
            <select id="region" name="region" [(ngModel)]="selectedRegion" (change)="onRegionChange()">
              <option value="" disabled selected>Selecciona una región</option>
              <option *ngFor="let region of regions" [ngValue]="region">{{ region.region }}</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="comuna">Comuna</label>
          <div class="input-with-icon">
            <i class="fas fa-map-pin"></i>
            <select id="comuna" name="comuna" [(ngModel)]="selectedComuna" [disabled]="!selectedRegion">
              <option value="" disabled selected>Selecciona una comuna</option>
              <option *ngFor="let comuna of comunas" [ngValue]="comuna">{{ comuna }}</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Step 2: Logo -->
      <div *ngSwitchCase="2">
        <div class="form-group">
          <label for="logo">Logo del Equipo</label>
          <div class="file-upload-form" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
            <label class="file-upload-label" for="file">
              <div class="file-upload-design">
                <img [src]="logoPreview" *ngIf="logoPreview" class="logo-preview" />
                <div *ngIf="!logoPreview" class="upload-content" (click)="fileInput.click()">
                  <i class="fas fa-cloud-upload-alt upload-icon"></i>
                  <div class="upload-text">
                    <p>Arrastra y suelta tu logo aquí</p>
                    <div class="upload-divider">
                      <span>o</span>
                    </div>
                    <button type="button" class="browse-button" (click)="$event.stopPropagation(); fileInput.click()">Seleccionar archivo</button>
                  </div>
                </div>
              </div>
              <input #fileInput type="file" id="file" (change)="onFileSelected($event)" accept="image/*" style="display: none;">
            </label>
          </div>
        </div>
      </div>

      <!-- Step 3: Schedule -->
      <div *ngSwitchCase="3">
        <div class="schedule-container">
          <!-- Progress Steps -->
          <div class="progress-steps">
            <div class="progress-step" [class.active]="currentSubStep === 'days'" (click)="setCurrentSubStep('days')">
              <div class="step-number">1</div>
              <div class="step-label">Días</div>
            </div>
            <div class="progress-connector"></div>
            <div class="progress-step" [class.active]="currentSubStep === 'times'" (click)="setCurrentSubStep('times')">
              <div class="step-number">2</div>
              <div class="step-label">Horarios</div>
            </div>
            <div class="progress-connector"></div>
            <div class="progress-step" [class.active]="currentSubStep === 'summary'" (click)="setCurrentSubStep('summary')">
              <div class="step-number">3</div>
              <div class="step-label">Resumen</div>
            </div>
          </div>

          <!-- Step: Days Selection -->
          <div *ngIf="currentSubStep === 'days'">
            <h3 class="schedule-subtitle">Selecciona los días disponibles</h3>
            <p class="schedule-description">Selecciona los días de la semana y los horarios en los que estás disponible para
              participar en el equipo</p>
          
            <div class="days-container">
              <div *ngFor="let dayObj of selectedDays" class="day-card" [class.day-selected]="dayObj.timeSlot"
                (click)="toggleDay(dayObj.day)">
                <div class="day-content">
                  <span class="day-name">{{ dayObj.day.substring(0, 2) }}</span>
                </div>
              </div>
            </div>
            <div class="step-actions">
              <button type="button" class="next-button" [disabled]="!hasSelectedDays()" (click)="setCurrentSubStep('times')">
                <span>Continuar</span>
                <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </div>

          <!-- Step: Times Selection -->
          <div *ngIf="currentSubStep === 'times'">
            <div class="step-header">
              <h3 class="schedule-subtitle">Configura tus horarios</h3>
            </div>
            <div class="time-slots-container">
              <ng-container *ngFor="let dayObj of selectedDays">
                <div *ngIf="dayObj.timeSlot" class="time-slot">
                  <div class="time-slot-header">
                    <span>{{ dayObj.day }}</span>
                    <button type="button" class="edit-time-button" (click)="toggleDay(dayObj.day)">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                  <div class="time-select-container">
                    <div class="time-select-group">
                      <label class="time-label">Hora de inicio</label>
                      <div class="select-wrapper">
                        <i class="fas fa-clock"></i>
                        <select id="startTime-{{dayObj.day}}" name="startTime-{{dayObj.day}}" [(ngModel)]="schedule[dayObj.day]!.startTime" (change)="updateSelectedDayTime(dayObj.day)">
                          <option *ngFor="let time of timeSlots" [ngValue]="time">{{ time }}</option>
                        </select>
                      </div>
                    </div>
                    <div class="time-select-group">
                      <label class="time-label">Hora de fin</label>
                      <div class="select-wrapper">
                        <i class="fas fa-clock"></i>
                        <select id="endTime-{{dayObj.day}}" name="endTime-{{dayObj.day}}" [(ngModel)]="schedule[dayObj.day]!.endTime" (change)="updateSelectedDayTime(dayObj.day)">
                          <option *ngFor="let time of timeSlots" [ngValue]="time">{{ time }}</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>
            </div>
            <div class="step-actions">
              <button type="button" class="next-button" [disabled]="!hasSelectedDaysWithTimes()" (click)="setCurrentSubStep('summary')">
                <span>Continuar</span>
                <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </div>

          <!-- Step: Summary -->
          <div *ngIf="currentSubStep === 'summary'">
            <div class="step-header">
              <h3 class="schedule-subtitle">Resumen de tu disponibilidad</h3>
            </div>
            <div class="summary-container">
              <div *ngFor="let dayObj of getOrderedSelectedDays()">
                <div class="summary-item">
                  <span class="summary-day">{{ dayObj.day }}</span>
                  <span class="summary-time">{{ schedule[dayObj.day]!.startTime }} - {{ schedule[dayObj.day]!.endTime }}</span>
                </div>
              </div>
              <div class="no-days-selected" *ngIf="!hasSelectedDaysWithTimes()">
                <p>No has seleccionado ningún día con horario disponible</p>
              </div>
            </div>
            <div class="summary-actions">
            </div>
            <div class="form-validation-message" *ngIf="currentSubStep === 'summary' && !isFormValid()">
              <p>Por favor completa todos los campos requeridos para habilitar el botón de registro.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="button-container">
      <button type="button" class="nav-button back-button" (click)="prevStep()" *ngIf="currentStep > 1">Atrás</button>
      <button type="button" class="next-button" (click)="nextStep()" *ngIf="currentStep < 3">
        <span>Siguiente</span>
        <i class="fas fa-arrow-right"></i>
      </button>
      <button type="submit" class="next-button" *ngIf="currentStep === 3" [disabled]="!isFormValid() || isLoading">
        <ng-container *ngIf="!isLoading">
          Registrar Equipo <i class="fas fa-check-circle"></i>
        </ng-container>
        <ng-container *ngIf="isLoading">
          <i class="fas fa-spinner fa-spin"></i>
        </ng-container>
      </button>
    </div>
  </form>
</div>
